(function(){"use strict";var e={4594:function(e,a,t){var o=t(5130),r=t(6768),n=t(657),l=t(144),s=(t(4114),t(4373)),i=t(7694),c=t(1387),u=(t(4603),t(7566),t(8721),t(4232)),d=t(1576),p=t.n(d),g=t(4079),m=t(2076);const h=(0,r.pM)({name:"ReportTable"});var y=(0,r.pM)({...h,props:{tabKey:{},columns:{},dataSource:{},paginationConfig:{},paginationParams:{}},emits:["download"],setup(e,{emit:a}){const t=a,o=e,n=e=>{const a=p()(e).format("YYYY-MM-DD HH:mm:ss");t("download",o.tabKey,a)};return(e,a)=>{const t=(0,r.g2)("a-button"),o=(0,r.g2)("a-table");return(0,r.uX)(),(0,r.Wv)(o,{columns:e.columns,"data-source":e.dataSource,bordered:"",pagination:e.paginationConfig,"row-key":e=>e.id},{bodyCell:(0,r.k6)((({column:o,record:s,index:i})=>["index"===o.key?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.eW)((0,u.v_)((e.paginationParams.pageIndex-1)*e.paginationParams.pageSize+i+1),1)],64)):"createTime"===o.dataIndex?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.eW)((0,u.v_)((0,l.R1)(p())(s.createdtime).format("YYYY-MM-DD HH:mm:ss")),1)],64)):"action"===o.key?((0,r.uX)(),(0,r.Wv)(t,{key:2,onClick:e=>n(s.createdtime)},{default:(0,r.k6)((()=>a[0]||(a[0]=[(0,r.eW)("下载")]))),_:2},1032,["onClick"])):(0,r.Q3)("",!0)])),_:1},8,["columns","data-source","pagination","row-key"])}}}),f=t(1241);const v=(0,f.A)(y,[["__scopeId","data-v-22f297c0"]]);var b=v,k=t(6011),w=t(8392);t(4514);const x={id:"userManagePage"},L={class:"batch-download-container"},A={class:"batch-tips"};var _=(0,r.pM)({__name:"HomePage",setup(e){p().locale("zh-cn");const a=[{key:"1",tab:"日报表"},{key:"2",tab:"周报表"},{key:"3",tab:"月报表"},{key:"4",tab:"年报表"}],t=[{title:"序号",key:"index",width:80,align:"center"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action",width:120,align:"center"}],o=(0,l.KR)("1"),n=(0,l.KR)(!1),s=(0,l.Kh)({pageIndex:1,pageSize:10,total:0}),c=(0,l.Kh)({1:{list:[]},2:{list:[]},3:{list:[]},4:{list:[]}}),d=(0,l.KR)(""),h=(0,l.KR)(null),y=(0,l.KR)(!1),f=(0,r.EW)((()=>({current:s.pageIndex,pageSize:s.pageSize,total:s.total,pageSizeOptions:["10","20","50","100"],showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`,onChange:(e,t)=>{s.pageIndex=e,s.pageSize=t,a.map((e=>e.key)).includes(o.value)&&T(o.value)},onShowSizeChange:(e,t)=>{s.pageIndex=1,s.pageSize=t,a.map((e=>e.key)).includes(o.value)&&T(o.value)}}))),v=e=>e?.isAfter(p()().endOf("month"))||!1,_=()=>d.value?!!h.value||(i.Ay.warning("请选择报表月份"),!1):(i.Ay.warning("请选择报表类型"),!1),F=(e,a,t)=>{const o={xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",zip:"application/zip"},r=new Blob([e.data],{type:o[t]}),n=e.headers?.["content-disposition"];let l=a;if(n){const e=n.match(/filename\*=UTF-8''([^;]+)/i);if(e?.[1])l=decodeURIComponent(e[1]);else{const e=n.match(/filename=([^;]+)/i);e?.[1]&&(l=decodeURIComponent(e[1].replace(/['"]/g,"")))}}const s=window.URL.createObjectURL(r),c=document.createElement("a");c.href=s,c.download=l,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(s),i.Ay.success(("xlsx"===t?"报表":"ZIP包")+"下载成功")},S=async(e,a)=>{if(!a)return i.Ay.warning("ID 不能为空");try{const t=await Pe(a,Number(e));F(t,"报表.xlsx","xlsx")}catch(t){console.error("报表下载失败：",t),i.Ay.error("下载失败：网络异常或接口错误")}},C=async()=>{if(!_())return;const e=h.value.format("YYYY-MM-01"),a={type:Number(d.value),timeStr:e};try{y.value=!0;const e=await Ke(a);F(e,`报表_${h.value.format("YYYYMM")}.zip`,"zip")}catch(t){console.error("批量下载ZIP失败：",t),i.Ay.error("批量下载失败：网络异常或接口错误")}finally{y.value=!1}},U=e=>{o.value=e,"5"!==e&&(s.pageIndex=1,T(e))},E=()=>{h.value=null},R=()=>{d.value="",h.value=null},T=async e=>{if(!n.value)try{n.value=!0;const a=await Ie({pageIndex:s.pageIndex,pageSize:s.pageSize,type:Number(e)});a.data?(c[e].list=a.data.data||[],s.total=a.data.totalCount||0):i.Ay.error(`获取${e}号表格数据失败`)}catch(a){console.error(`获取${e}号表格数据异常：`,a),i.Ay.error(`获取${e}号表格数据失败：网络异常`)}finally{n.value=!1}};return T("1"),(e,o)=>{const n=(0,r.g2)("a-tab-pane"),i=(0,r.g2)("a-select-option"),p=(0,r.g2)("a-select"),_=(0,r.g2)("a-form-item"),F=(0,r.g2)("a-date-picker"),T=(0,r.g2)("a-button"),I=(0,r.g2)("a-form"),P=(0,r.g2)("a-tabs");return(0,r.uX)(),(0,r.CE)("div",x,[(0,r.bF)(P,{"default-active-key":"1",type:"card",onChange:U},{default:(0,r.k6)((()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(a,(e=>(0,r.bF)(n,{key:e.key,tab:e.tab},{default:(0,r.k6)((()=>[(0,r.bF)(b,{"tab-key":e.key,columns:t,"data-source":c[e.key]?.list||[],"pagination-config":f.value,"pagination-params":s,onDownload:S},null,8,["tab-key","data-source","pagination-config","pagination-params"])])),_:2},1032,["tab"]))),64)),(0,r.bF)(n,{tab:"批量下载报表",key:"5"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",L,[o[5]||(o[5]=(0,r.Lk)("div",{class:"batch-download-header"},[(0,r.Lk)("h3",{class:"batch-download-title"},"批量报表下载"),(0,r.Lk)("p",{class:"batch-download-desc"}," 根据选择的报表类型和月份，下载对应月份的报表文件 ")],-1)),(0,r.bF)((0,l.R1)(k.Ay),{locale:(0,l.R1)(w.A)},{default:(0,r.k6)((()=>[(0,r.bF)(I,{class:"batch-download-form",layout:"vertical","label-col":{span:4},"wrapper-col":{span:20}},{default:(0,r.k6)((()=>[(0,r.bF)(_,{label:"报表类型","validate-status":d.value?"":"error",help:d.value?"":"请选择报表类型"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{value:d.value,"onUpdate:value":o[0]||(o[0]=e=>d.value=e),style:{width:"100%","max-width":"300px"},placeholder:"请选择报表类型","allow-clear":"",onChange:E},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.filter((e=>"4"!==e.key)),(e=>((0,r.uX)(),(0,r.Wv)(i,{key:e.key,value:e.key},{default:(0,r.k6)((()=>[(0,r.eW)((0,u.v_)(e.tab),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1},8,["validate-status","help"]),(0,r.bF)(_,{label:"选择月份","validate-status":!h.value&&d.value?"error":"",help:!h.value&&d.value?"请选择报表月份":""},{default:(0,r.k6)((()=>[(0,r.bF)(F,{value:h.value,"onUpdate:value":o[1]||(o[1]=e=>h.value=e),picker:"month",style:{width:"100%","max-width":"300px"},placeholder:"选择报表月份",format:"YYYY年MM月","allow-clear":"","disabled-date":v},null,8,["value"])])),_:1},8,["validate-status","help"]),(0,r.bF)(_,{"wrapper-col":{offset:4}},{default:(0,r.k6)((()=>[(0,r.bF)(T,{type:"primary",onClick:C,loading:y.value,class:"batch-download-btn"},{icon:(0,r.k6)((()=>[(0,r.bF)((0,l.R1)(g.A))])),default:(0,r.k6)((()=>[o[2]||(o[2]=(0,r.eW)(" 下载报表 "))])),_:1},8,["loading"]),(0,r.bF)(T,{onClick:R,style:{"margin-left":"12px"}},{default:(0,r.k6)((()=>o[3]||(o[3]=[(0,r.eW)(" 重置 ")]))),_:1}),(0,r.Lk)("div",A,[(0,r.bF)((0,l.R1)(m.A),{style:{"margin-right":"4px"}}),o[4]||(o[4]=(0,r.eW)(" 提示：下载所选月份的对应类型报表文件（默认按当月01日查询） "))])])),_:1})])),_:1})])),_:1},8,["locale"])])])),_:1})])),_:1})])}}});const F=(0,f.A)(_,[["__scopeId","data-v-3f6ffb36"]]);var S=F;const C={id:"userManagePage"},U={key:0},E={key:1},R={key:0},T={key:1},I={key:2};var P=(0,r.pM)({__name:"UserManagePage",setup(e){const a=(0,l.KR)(""),t=async()=>{c(a.value)},o=async e=>{if(!e)return;const a=await Te(e);0===a.data.code?(c(),i.Ay.success("删除成功")):i.Ay.error("删除失败")},n=[{title:"id",dataIndex:"id"},{title:"用户名",dataIndex:"userName"},{title:"账号",dataIndex:"userAccount"},{title:"头像",dataIndex:"avatarUrl"},{title:"性别",dataIndex:"gender"},{title:"创建时间",dataIndex:"createTime"},{title:"用户角色",dataIndex:"userRole"},{title:"操作",key:"action"}],s=(0,l.KR)([]),c=async(e="")=>{const a=await Re(e);a.data.data?s.value=a.data.data:i.Ay.error("获取数据失败")};return c(),(e,i)=>{const c=(0,r.g2)("a-input-search"),d=(0,r.g2)("a-image"),g=(0,r.g2)("a-tag"),m=(0,r.g2)("a-button"),h=(0,r.g2)("a-table");return(0,r.uX)(),(0,r.CE)("div",C,[(0,r.bF)(c,{style:{"max-width":"320px","margin-bottom":"20px"},value:a.value,"onUpdate:value":i[0]||(i[0]=e=>a.value=e),placeholder:"输入用户名搜索","enter-button":"搜索",size:"large",onSearch:t},null,8,["value"]),(0,r.bF)(h,{columns:n,"data-source":s.value},{bodyCell:(0,r.k6)((({column:e,record:a})=>["avatarUrl"===e.dataIndex?((0,r.uX)(),(0,r.Wv)(d,{key:0,src:a.avatarUrl,width:120},null,8,["src"])):"userRole"===e.dataIndex?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[1===a.role?((0,r.uX)(),(0,r.CE)("div",U,[(0,r.bF)(g,{color:"green"},{default:(0,r.k6)((()=>i[1]||(i[1]=[(0,r.eW)("管理员")]))),_:1})])):((0,r.uX)(),(0,r.CE)("div",E,[(0,r.bF)(g,{color:"blue"},{default:(0,r.k6)((()=>i[2]||(i[2]=[(0,r.eW)("普通用户")]))),_:1})]))],64)):"gender"===e.dataIndex?((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[0===a.gender?((0,r.uX)(),(0,r.CE)("div",R,[(0,r.bF)(g,{color:"blue"},{default:(0,r.k6)((()=>i[3]||(i[3]=[(0,r.eW)("男")]))),_:1})])):1===a.gender?((0,r.uX)(),(0,r.CE)("div",T,[(0,r.bF)(g,{color:"green"},{default:(0,r.k6)((()=>i[4]||(i[4]=[(0,r.eW)("女")]))),_:1})])):((0,r.uX)(),(0,r.CE)("div",I,[(0,r.bF)(g,{color:"gray"},{default:(0,r.k6)((()=>i[5]||(i[5]=[(0,r.eW)("未知")]))),_:1})]))],64)):(0,r.Q3)("",!0),"createTime"===e.dataIndex?((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.eW)((0,u.v_)((0,l.R1)(p())(a.createTime).format("YYYY-MM-DD HH:mm:ss")),1)],64)):"action"===e.key?((0,r.uX)(),(0,r.Wv)(m,{key:4,danger:"",onClick:e=>o(a.id)},{default:(0,r.k6)((()=>i[6]||(i[6]=[(0,r.eW)("删除")]))),_:2},1032,["onClick"])):(0,r.Q3)("",!0)])),_:1},8,["data-source"])])}}});const K=P;var Y=K;const O={id:"userLoginPage"},M={class:"login-card"};var W=(0,r.pM)({__name:"UserLoginPage",setup(e){const a=(0,c.rd)(),t=Ye(),o=(0,l.Kh)({userAccount:"",userPassword:""}),n=async e=>{try{console.log("登录请求参数：",e);const o=await Ce(e);console.log("登录接口返回：",o);const r=o.data||o;0===r.code&&r.data?(t.setLoginUser(r.data),i.Ay.success("登录成功"),setTimeout((async()=>{await a.push({path:"/app/components/leader-dashboard",replace:!0}),console.log("登录成功，跳转到首页")}),500)):i.Ay.error(r.message||"登录失败：账号或密码错误")}catch(o){i.Ay.error(o.message||"登录异常，请稍后重试"),console.error("登录请求失败：",o)}},s=e=>{console.log("表单验证失败：",e)};return(e,a)=>{const t=(0,r.g2)("a-input"),l=(0,r.g2)("a-form-item"),i=(0,r.g2)("a-input-password"),c=(0,r.g2)("a-button"),u=(0,r.g2)("a-form");return(0,r.uX)(),(0,r.CE)("div",O,[(0,r.Lk)("div",M,[a[3]||(a[3]=(0,r.Lk)("h2",{class:"title"},"用户登录",-1)),(0,r.bF)(u,{model:o,"label-align":"left",name:"basic","label-col":{span:4},"wrapper-col":{span:20},autocomplete:"off",onFinish:n,onFinishFailed:s},{default:(0,r.k6)((()=>[(0,r.bF)(l,{label:"账号",name:"userAccount",rules:[{required:!0,message:"请输入账号！"}]},{default:(0,r.k6)((()=>[(0,r.bF)(t,{value:o.userAccount,"onUpdate:value":a[0]||(a[0]=e=>o.userAccount=e),placeholder:"请输入账号"},null,8,["value"])])),_:1}),(0,r.bF)(l,{label:"密码",name:"userPassword",rules:[{required:!0,message:"请输入密码!"},{min:8,message:"密码不能小于8位"}]},{default:(0,r.k6)((()=>[(0,r.bF)(i,{value:o.userPassword,"onUpdate:value":a[1]||(a[1]=e=>o.userPassword=e),placeholder:"请输入密码"},null,8,["value"])])),_:1}),(0,r.bF)(l,{"wrapper-col":{offset:4,span:20}},{default:(0,r.k6)((()=>[(0,r.bF)(c,{type:"primary","html-type":"submit",block:""},{default:(0,r.k6)((()=>a[2]||(a[2]=[(0,r.eW)("登录")]))),_:1})])),_:1})])),_:1},8,["model"])])])}}});const z=(0,f.A)(W,[["__scopeId","data-v-c4f3cc64"]]);var q=z;const D={id:"userRegisterPage"};var X=(0,r.pM)({__name:"UserRegisterPage",setup(e){const a=(0,c.rd)(),t=Ye(),o=(0,l.Kh)({userAccount:"",userPassword:"",checkPassword:""}),n=async e=>{if(o.userPassword!==o.checkPassword)return void i.Ay.error("二次输入的密码不一致");const r=await Se(e);0===r.data.code&&r.data.data?(await t.fetchLoginUser(),i.Ay.success("注册成功"),a.push({path:"/user/login",replace:!0})):i.Ay.error("注册失败"+r.data.description)},s=e=>{console.log("Failed:",e)};return(e,a)=>{const t=(0,r.g2)("a-input"),l=(0,r.g2)("a-form-item"),i=(0,r.g2)("a-input-password"),c=(0,r.g2)("a-button"),u=(0,r.g2)("a-form");return(0,r.uX)(),(0,r.CE)("div",D,[a[4]||(a[4]=(0,r.Lk)("h2",{class:"title"},"用户注册",-1)),(0,r.bF)(u,{style:{"max-width":"480px",margin:"0 auto"},model:o,"label-align":"left",name:"basic","label-col":{span:4},"wrapper-col":{span:20},autocomplete:"off",onFinish:n,onFinishFailed:s},{default:(0,r.k6)((()=>[(0,r.bF)(l,{label:"账号",name:"userAccount",rules:[{required:!0,message:"请输入账号！"}]},{default:(0,r.k6)((()=>[(0,r.bF)(t,{value:o.userAccount,"onUpdate:value":a[0]||(a[0]=e=>o.userAccount=e)},null,8,["value"])])),_:1}),(0,r.bF)(l,{label:"密码",name:"userPassword",rules:[{required:!0,message:"请输入密码!"},{min:8,message:"密码不能小于8位"}]},{default:(0,r.k6)((()=>[(0,r.bF)(i,{value:o.userPassword,"onUpdate:value":a[1]||(a[1]=e=>o.userPassword=e),placeholder:"请输入密码"},null,8,["value"])])),_:1}),(0,r.bF)(l,{label:"确认密码",name:"checkPassword",rules:[{required:!0,message:"请输入确认密码!"},{min:8,message:"确认密码不能小于8位"}]},{default:(0,r.k6)((()=>[(0,r.bF)(i,{value:o.checkPassword,"onUpdate:value":a[2]||(a[2]=e=>o.checkPassword=e),placeholder:"请输入确认密码"},null,8,["value"])])),_:1}),(0,r.bF)(l,{"wrapper-col":{offset:4,span:20}},{default:(0,r.k6)((()=>[(0,r.bF)(c,{type:"primary","html-type":"submit"},{default:(0,r.k6)((()=>a[3]||(a[3]=[(0,r.eW)("注册")]))),_:1})])),_:1})])),_:1},8,["model"])])}}});const j=X;var N=j,G=t.p+"img/hb.66d72f90.png",$=t(1229),B=t(8709);const H={class:"layout-container"},J={class:"sidebar"},Q={class:"logout-btn"},Z={class:"main-content"};var V=(0,r.pM)({__name:"BasicLayout",setup(e){const a=(0,c.rd)(),t=Ye(),o=(0,l.KR)([{key:"/app/components/leader-dashboard",label:"数据看板",title:"数据看板",icon:()=>(0,r.h)($.A)},{key:"/app/home",label:"报表",title:"报表",icon:()=>(0,r.h)(B.A)}]),n=({key:e})=>{a.push(e)},s=(0,l.KR)(["/app/home"]);a.afterEach((e=>{s.value=[e.path]}));const u=async()=>{try{await Ue({}),"function"===typeof t.clearLoginUser?t.clearLoginUser():t.loginUser={userName:"未登录"},localStorage.removeItem("loginUser"),localStorage.removeItem("token"),d(),i.Ay.success("退出成功"),a.replace({path:"/user/login"})}catch(e){console.error("退出登录接口调用失败：",e),"function"===typeof t.clearLoginUser?t.clearLoginUser():t.loginUser={userName:"未登录"},localStorage.removeItem("loginUser"),localStorage.removeItem("token"),d(),i.Ay.success("已退出登录"),a.replace({path:"/user/login"})}},d=()=>{const e=document.cookie.split(";");for(let a=0;a<e.length;a++){const t=e[a],o=t.indexOf("="),r=o>-1?t.substr(0,o).trim():t.trim();document.cookie=`${r}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=${window.location.hostname}`}};return(e,a)=>{const t=(0,r.g2)("a-menu"),l=(0,r.g2)("a-button"),i=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",H,[(0,r.Lk)("aside",J,[a[2]||(a[2]=(0,r.Lk)("div",{class:"sidebar-header"},[(0,r.Lk)("img",{class:"logo",src:G,alt:"logo"})],-1)),(0,r.bF)(t,{selectedKeys:s.value,"onUpdate:selectedKeys":a[0]||(a[0]=e=>s.value=e),mode:"vertical",items:o.value,onClick:n,class:"sidebar-menu"},null,8,["selectedKeys","items"]),(0,r.Lk)("div",Q,[(0,r.bF)(l,{type:"text",onClick:u},{default:(0,r.k6)((()=>a[1]||(a[1]=[(0,r.eW)("退出登录")]))),_:1})])]),(0,r.Lk)("main",Z,[(0,r.bF)(i)])])}}});const ee=(0,f.A)(V,[["__scopeId","data-v-29ca902e"]]);var ae=ee,te=(t(8992),t(3949),t(1454),t(2805));const oe=async()=>Fe.request({url:"/api/Dashboard/getLineChartOne",method:"GET"}),re=async()=>Fe.request({url:"/api/Dashboard/getLineChartTwo",method:"GET"}),ne=async()=>Fe.request({url:"/api/Dashboard/getLineChartThree",method:"GET"}),le=async()=>Fe.request({url:"/api/Dashboard/getPieChart",method:"GET"}),se=async()=>Fe.request({url:"/api/Dashboard/getCoreChart",method:"GET"});var ie=t(9041);const ce={id:"leaderDashboardPage"},ue={class:"production-cards"},de={class:"chart-section pie-chart-section"},pe={style:{width:"100%",height:"300px"}},ge={class:"chart-section line-charts-section"},me={style:{width:"100%",height:"300px"}},he={style:{width:"100%",height:"300px"}},ye={style:{width:"100%",height:"300px"}},fe={class:"refresh-btn-group"};var ve=(0,r.pM)({__name:"LeaderDashboard",setup(e){const a=(0,l.KR)(!1),t=(0,l.Kh)({pie:!1,dayLine:!1,weekLine:!1,monthLine:!1}),o=(0,l.Kh)({yesterday:0,week:0,month:0,year:0}),n=(0,l.KR)(null),s=(0,l.KR)(null),c=(0,l.KR)(null),u=(0,l.KR)(null);let d=null,p=null,g=null,m=null,h=null;const y=(0,l.KR)([]),f=(0,l.KR)({xAxis:[],series:[]}),v=(0,l.KR)({xAxis:[],series:[]}),b=(0,l.KR)({xAxis:[],series:[]}),k=async e=>{try{const e=await se(),a=e.data;if(0!==a.code)throw new Error(a.message);Object.assign(o,a.data)}catch(a){console.error("获取核心产量数据失败：",a),i.Ay.error("核心产量数据加载失败")}},w=async e=>{try{t.pie=!0;const e=await le(),a=e.data;if(0!==a.code)throw new Error(a.message);y.value=a.data,await(0,r.dY)(),setTimeout((()=>_("pie")),100)}catch(a){console.error("获取饼图数据失败：",a),i.Ay.error("产量占比图表数据加载失败")}finally{t.pie=!1}},x=async e=>{try{t.dayLine=!0;const e=await oe(),a=e.data;if(0!==a.code)throw new Error(a.message||"获取昨日时段产量数据失败");if(!(a.data&&a.data.xAxis&&a.data.series))throw new Error("接口返回数据格式异常");f.value=a.data,await(0,r.dY)(),setTimeout((()=>_("dayLine")),100)}catch(a){console.error("获取日折线图数据失败：",a),i.Ay.error("昨日时段产量趋势图表数据加载失败"),await(0,r.dY)(),setTimeout((()=>_("dayLine")),100)}finally{t.dayLine=!1}},L=async e=>{try{t.weekLine=!0;const e=await re(),a=e.data;if(0!==a.code)throw new Error(a.message||"获取周产量数据失败");if(!(a.data&&a.data.xAxis&&a.data.series))throw new Error("接口返回数据格式异常");v.value=a.data,await(0,r.dY)(),setTimeout((()=>_("weekLine")),100)}catch(a){console.error("获取周折线图数据失败：",a),i.Ay.error("周产量趋势图表数据加载失败"),await(0,r.dY)(),setTimeout((()=>_("weekLine")),100)}finally{t.weekLine=!1}},A=async e=>{try{t.monthLine=!0;const e=await ne(),a=e.data;if(0!==a.code)throw new Error(a.message||"获取月产量数据失败");if(!(a.data&&a.data.xAxis&&a.data.series))throw new Error("接口返回数据格式异常");b.value=a.data,await(0,r.dY)(),setTimeout((()=>_("monthLine")),100)}catch(a){console.error("获取月折线图数据失败：",a),i.Ay.error("月产量趋势图表数据加载失败"),await(0,r.dY)(),setTimeout((()=>_("monthLine")),100)}finally{t.monthLine=!1}},_=(e="all")=>{if("pie"===e||"all"===e){if(!n.value||!y.value||0===y.value.length)return;try{d&&d.dispose(),d=ie.Ts(n.value),d.setOption({color:["#003399","#00AEEF","#0066CC","#66B2FF"],tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} 件 ({d}%)"},legend:{orient:"horizontal",bottom:0,textStyle:{color:"#333"}},series:[{name:"产量占比",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!1},emphasis:{label:{show:!0,fontSize:16,fontWeight:600}},labelLine:{show:!1},data:y.value}]})}catch(a){console.error("初始化饼图失败：",a)}}if("dayLine"===e||"all"===e){if(!s.value||!f.value||!f.value.xAxis||!f.value.series||0===f.value.series.length)return;try{p&&p.dispose(),p=ie.Ts(s.value),p.setOption({color:["#003399"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"horizontal",top:0,left:"center",textStyle:{color:"#333",fontSize:12}},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:f.value.xAxis,axisLine:{lineStyle:{color:"#e8f4fc"}},axisLabel:{color:"#666"}},yAxis:{type:"value",name:"产量(件)",nameTextStyle:{color:"#003399"},axisLine:{lineStyle:{color:"#e8f4fc"}},axisLabel:{color:"#666"},splitLine:{lineStyle:{color:"#e8f4fc"}}},series:f.value.series.map((e=>({name:e.name,type:"line",smooth:!0,data:e.data,lineStyle:{width:2},itemStyle:{color:"#00AEEF",borderColor:"#003399",borderWidth:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(0, 174, 239, 0.2)"},{offset:1,color:"rgba(0, 174, 239, 0.05)"}]}}})))})}catch(a){console.error("初始化日折线图失败：",a)}}if("weekLine"===e||"all"===e){if(!c.value||!v.value||!v.value.series||0===v.value.series.length)return;try{g&&g.dispose(),g=ie.Ts(c.value),g.setOption({color:["#003399"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"horizontal",top:0,left:"center",textStyle:{color:"#333",fontSize:12}},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:v.value.xAxis,axisLine:{lineStyle:{color:"#e8f4fc"}},axisLabel:{color:"#666"}},yAxis:{type:"value",name:"产量(件)",nameTextStyle:{color:"#003399"},axisLine:{lineStyle:{color:"#e8f4fc"}},axisLabel:{color:"#666"},splitLine:{lineStyle:{color:"#e8f4fc"}}},series:v.value.series.map((e=>({name:e.name,type:"line",smooth:!0,data:e.data,lineStyle:{width:2},itemStyle:{color:"#00AEEF",borderColor:"#003399",borderWidth:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(0, 174, 239, 0.2)"},{offset:1,color:"rgba(0, 174, 239, 0.05)"}]}}})))})}catch(a){console.error("初始化周折线图失败：",a)}}if("monthLine"===e||"all"===e){if(!u.value||!b.value||!b.value.series||0===b.value.series.length)return;try{m&&m.dispose(),m=ie.Ts(u.value),m.setOption({color:["#003399","#00AEEF"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"horizontal",top:0,left:"center",textStyle:{color:"#333",fontSize:12}},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:b.value.xAxis,axisLine:{lineStyle:{color:"#e8f4fc"}},axisLabel:{color:"#666"}},yAxis:{type:"value",name:"产量(件)",nameTextStyle:{color:"#003399"},axisLine:{lineStyle:{color:"#e8f4fc"}},axisLabel:{color:"#666"},splitLine:{lineStyle:{color:"#e8f4fc"}}},series:b.value.series.map(((e,a)=>({name:e.name,type:"line",smooth:!0,data:e.data,lineStyle:{width:2},itemStyle:{color:0===a?"#003399":"#00AEEF",borderColor:0===a?"#0066CC":"#66B2FF",borderWidth:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:0===a?"rgba(0, 51, 153, 0.2)":"rgba(0, 174, 239, 0.2)"},{offset:1,color:0===a?"rgba(0, 51, 153, 0.05)":"rgba(0, 174, 239, 0.05)"}]}}})))})}catch(a){console.error("初始化月折线图失败：",a)}}},F=()=>{d?.resize(),p?.resize(),g?.resize(),m?.resize()},S=async()=>{try{a.value=!0;const e={};await k(e),w(e),x(e),L(e),A(e),i.Ay.success("数据刷新请求已发送")}catch(e){console.error("获取核心数据失败：",e),i.Ay.error("核心数据加载失败，请稍后重试")}finally{setTimeout((()=>{a.value=!1}),600)}};return(0,r.sV)((async()=>{await S(),window.addEventListener("resize",F),h=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(console.log("【DOM监听】图表容器可见，触发初始化"),_("all"))}))}),{threshold:.1}),n.value&&h.observe(n.value),s.value&&h.observe(s.value),c.value&&h.observe(c.value),u.value&&h.observe(u.value)})),(0,r.$u)((async()=>{await(0,r.dY)(),_("all")})),(0,r.hi)((()=>{d?.dispose(),p?.dispose(),g?.dispose(),m?.dispose(),window.removeEventListener("resize",F),h&&(h.disconnect(),h=null)})),(0,r.wB)(y,(async()=>{await(0,r.dY)(),_("pie")}),{deep:!0}),(0,r.wB)(f,(async()=>{await(0,r.dY)(),_("dayLine")}),{deep:!0}),(0,r.wB)(v,(async()=>{await(0,r.dY)(),_("weekLine")}),{deep:!0}),(0,r.wB)(b,(async()=>{await(0,r.dY)(),_("monthLine")}),{deep:!0}),(e,i)=>{const d=(0,r.g2)("a-statistic"),p=(0,r.g2)("a-card"),g=(0,r.g2)("a-button");return(0,r.uX)(),(0,r.CE)("div",ce,[i[1]||(i[1]=(0,r.Lk)("div",{class:"page-header"},[(0,r.Lk)("h2",{class:"page-title"},"数据看板"),(0,r.Lk)("p",{class:"page-desc"},"展示核心指标及趋势数据")],-1)),(0,r.Lk)("div",ue,[(0,r.bF)(p,{class:"production-card",loading:a.value,hoverable:""},{default:(0,r.k6)((()=>[(0,r.bF)(d,{title:"昨日产量",value:o.yesterday,precision:2,suffix:"kg",class:"stat-item"},{prefix:(0,r.k6)((()=>[(0,r.bF)((0,l.R1)(te.A),{class:"stat-icon"})])),_:1},8,["value"])])),_:1},8,["loading"]),(0,r.bF)(p,{class:"production-card",loading:a.value,hoverable:""},{default:(0,r.k6)((()=>[(0,r.bF)(d,{title:"当周产量",value:o.week,precision:2,suffix:"kg",class:"stat-item"},{prefix:(0,r.k6)((()=>[(0,r.bF)((0,l.R1)(te.A),{class:"stat-icon"})])),_:1},8,["value"])])),_:1},8,["loading"]),(0,r.bF)(p,{class:"production-card",loading:a.value,hoverable:""},{default:(0,r.k6)((()=>[(0,r.bF)(d,{title:"当月产量",value:o.month,precision:2,suffix:"kg",class:"stat-item"},{prefix:(0,r.k6)((()=>[(0,r.bF)((0,l.R1)(te.A),{class:"stat-icon"})])),_:1},8,["value"])])),_:1},8,["loading"]),(0,r.bF)(p,{class:"production-card",loading:a.value,hoverable:""},{default:(0,r.k6)((()=>[(0,r.bF)(d,{title:"今年产量",value:o.year,precision:2,suffix:"kg",class:"stat-item"},{prefix:(0,r.k6)((()=>[(0,r.bF)((0,l.R1)(te.A),{class:"stat-icon"})])),_:1},8,["value"])])),_:1},8,["loading"])]),(0,r.Lk)("div",de,[(0,r.bF)(p,{class:"chart-card",loading:t.pie,title:"产量占比分析","title-style":{color:"#003399",fontWeight:600}},{default:(0,r.k6)((()=>[(0,r.Lk)("div",pe,[(0,r.Lk)("div",{ref_key:"pieChartRef",ref:n,class:"chart-container"},null,512)])])),_:1},8,["loading"])]),(0,r.Lk)("div",ge,[(0,r.bF)(p,{class:"chart-card line-chart-card",loading:t.dayLine,title:"昨日时段产量趋势","title-style":{color:"#003399",fontWeight:600}},{default:(0,r.k6)((()=>[(0,r.Lk)("div",me,[(0,r.Lk)("div",{ref_key:"dayLineChartRef",ref:s,class:"chart-container"},null,512)])])),_:1},8,["loading"]),(0,r.bF)(p,{class:"chart-card line-chart-card",loading:t.weekLine,title:"周产量趋势","title-style":{color:"#003399",fontWeight:600}},{default:(0,r.k6)((()=>[(0,r.Lk)("div",he,[(0,r.Lk)("div",{ref_key:"weekLineChartRef",ref:c,class:"chart-container"},null,512)])])),_:1},8,["loading"]),(0,r.bF)(p,{class:"chart-card line-chart-card",loading:t.monthLine,title:"月产量趋势","title-style":{color:"#003399",fontWeight:600}},{default:(0,r.k6)((()=>[(0,r.Lk)("div",ye,[(0,r.Lk)("div",{ref_key:"monthLineChartRef",ref:u,class:"chart-container"},null,512)])])),_:1},8,["loading"])]),(0,r.Lk)("div",fe,[(0,r.bF)(g,{type:"primary",onClick:S,loading:a.value,icon:"reload"},{default:(0,r.k6)((()=>i[0]||(i[0]=[(0,r.eW)(" 刷新全部数据 ")]))),_:1},8,["loading"])])])}}});const be=(0,f.A)(ve,[["__scopeId","data-v-35dace91"]]);var ke=be;const we=[{path:"/",redirect:"/user/login"},{path:"/user/login",name:"userLogin",component:q,meta:{requiresAuth:!1}},{path:"/user/register",name:"userRegister",component:N,meta:{requiresAuth:!1}},{path:"/app",component:ae,meta:{requiresAuth:!0},children:[{path:"home",name:"homePage",component:S},{path:"admin/userManage",name:"adminUserManage",component:Y},{path:"components/leader-dashboard",name:"LeaderDashboard",component:ke,meta:{title:"领导仓数据看板"}}]},{path:"/:pathMatch(.*)*",redirect:"/user/login"}],xe=(0,c.aE)({history:(0,c.LA)("/"),routes:we});xe.beforeEach(((e,a,t)=>{const o=Ye(),r=localStorage.getItem("loginUser");if(r)try{const e=JSON.parse(r);e.id&&!o.loginUser.id&&o.setLoginUser(e)}catch(l){console.error("本地存储用户信息异常：",l),localStorage.removeItem("loginUser"),o.setLoginUser({id:""})}const n=!!o.loginUser.id;e.meta.requiresAuth?n?t():(i.Ay.warning("请先登录后再访问"),t({path:"/user/login",query:{redirect:encodeURIComponent(e.fullPath)}})):!n||"/user/login"!==e.path&&"/user/register"!==e.path?t():t("/app/home")}));var Le=xe;let Ae=!1;const _e=s.A.create({baseURL:window.location.origin,timeout:1e4,withCredentials:!0});_e.interceptors.request.use((function(e){return e.headers["Content-Type"]||(e.headers["Content-Type"]="application/json;charset=UTF-8"),e}),(function(e){return i.Ay.error("请求配置异常，请检查参数或网络设置"),console.error("请求拦截器错误：",e),Promise.reject(e)})),_e.interceptors.response.use((function(e){if("blob"===e.config.responseType){let a="导出文件.xlsx";if(e.headers["content-disposition"]||e.headers["Content-Disposition"])try{const t=e.headers["content-disposition"]||e.headers["Content-Disposition"];a=decodeURI(t.split("filename=")[1]),a=a.replace(/"/g,"")}catch(t){a="导出文件.xlsx"}return e.fileBlobData=e.data,e.fileDownloadName=a,e}const{data:a}=e;if(console.log("响应数据：",a),40100===a.code){const a=e.request.responseURL.includes("user/current"),t=Le.currentRoute.value.path.includes("/user/login");if(!a&&!t&&!Ae){Ae=!0,i.Ay.warning("登录状态已过期，请重新登录");const e=Ye();e.setLoginUser({id:""}),localStorage.removeItem("loginUser"),Le.push({path:"/user/login",query:{redirect:encodeURIComponent(Le.currentRoute.value.fullPath)}}).finally((()=>{Ae=!1}))}}return a.code&&0!==a.code&&40100!==a.code&&i.Ay.error(a.message||`请求失败（错误码：${a.code}）`),e}),(function(e){if(e.response){const a=e.response.status;if(401!==a||Ae)401!==a&&i.Ay.error(`请求失败（HTTP状态码：${a}）`);else{const e=Le.currentRoute.value.path.includes("/user/login");if(!e){Ae=!0,i.Ay.warning("登录状态已过期，请重新登录");const e=Ye();e.setLoginUser({id:""}),localStorage.removeItem("loginUser"),Le.push({path:"/user/login",query:{redirect:encodeURIComponent(Le.currentRoute.value.fullPath)}}).finally((()=>{Ae=!1}))}}}else e.request?i.Ay.error("网络异常，请检查网络连接"):i.Ay.error("请求配置失败："+e.message);return console.error("响应拦截器错误：",e),Promise.reject(e)}));var Fe=_e;const Se=async e=>Fe.request({url:"api/user/register",method:"POST",data:e}),Ce=async e=>Fe.request({url:"api/user/login",method:"POST",data:e}),Ue=async e=>Fe.request({url:"api/user/logout",method:"POST",data:e}),Ee=async()=>Fe.request({url:"api/user/current",method:"GET"}),Re=async e=>Fe.request({url:"api/user/search",method:"GET",params:{userName:e}}),Te=async e=>Fe.request({url:"api/user/delete",method:"POST",data:e,headers:{"Content-Type":"application/json"}}),Ie=async e=>Fe.request({url:"/api/ReportRecord/GetReportByPage",method:"GET",params:e}),Pe=async(e,a)=>Fe.request({url:"api/Report/DownloadExcel",method:"GET",params:{timeStr:e,Type:a},responseType:"blob",timeout:6e4}),Ke=async e=>Fe.request({url:"/api/File/ZipDownloadFile",method:"GET",params:e,responseType:"blob",timeout:12e4}),Ye=(0,n.nY)("loginUser",(()=>{const e=(0,l.KR)(localStorage.getItem("loginUser")?JSON.parse(localStorage.getItem("loginUser")):{userName:"未登录"});async function a(){try{const a=await Ee();0===a.data.code&&a.data.data&&(console.log("接口获取用户信息：",a.data.data),e.value=a.data.data,localStorage.setItem("loginUser",JSON.stringify(a.data.data)),a.data.data.token&&localStorage.setItem("token",a.data.data.token))}catch(a){console.error("获取当前用户信息失败：",a)}}function t(a){e.value=a,localStorage.setItem("loginUser",JSON.stringify(a)),a.token&&localStorage.setItem("token",a.token)}function o(){e.value={userName:"未登录"},localStorage.removeItem("loginUser"),localStorage.removeItem("token")}function r(){const a=localStorage.getItem("loginUser");a&&(e.value=JSON.parse(a))}return{loginUser:e,setLoginUser:t,fetchLoginUser:a,clearLoginUser:o,restoreLoginUser:r}})),Oe={id:"app"};var Me=(0,r.pM)({__name:"App",setup(e){const a=Ye();return a.fetchLoginUser(),(e,a)=>{const t=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",Oe,[(0,r.bF)(t)])}}});const We=Me;var ze=We,qe=t(1403);t(4529);const De=(0,o.Ef)(ze);De.use((0,n.Ey)()),De.use(Le),De.use(qe.Ay),window.addEventListener("unhandledrejection",(e=>{e.preventDefault();const a=e.reason;401!==a?.response?.status&&40100!==a?.response?.data?.code?(i.Ay.error("系统异常，请稍后重试"),console.error("全局捕获未处理的Promise错误：",a)):console.info("401错误已在axios拦截器中处理，无需重复提示",a)})),De.use(qe.Ay),De.config.globalProperties.$message=i.Ay;const Xe=Ye();Xe.restoreLoginUser(),De.mount("#app")}},a={};function t(o){var r=a[o];if(void 0!==r)return r.exports;var n=a[o]={exports:{}};return e[o].call(n.exports,n,n.exports,t),n.exports}t.m=e,function(){var e=[];t.O=function(a,o,r,n){if(!o){var l=1/0;for(u=0;u<e.length;u++){o=e[u][0],r=e[u][1],n=e[u][2];for(var s=!0,i=0;i<o.length;i++)(!1&n||l>=n)&&Object.keys(t.O).every((function(e){return t.O[e](o[i])}))?o.splice(i--,1):(s=!1,n<l&&(l=n));if(s){e.splice(u--,1);var c=r();void 0!==c&&(a=c)}}return a}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[o,r,n]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){var e={524:0};t.O.j=function(a){return 0===e[a]};var a=function(a,o){var r,n,l=o[0],s=o[1],i=o[2],c=0;if(l.some((function(a){return 0!==e[a]}))){for(r in s)t.o(s,r)&&(t.m[r]=s[r]);if(i)var u=i(t)}for(a&&a(o);c<l.length;c++)n=l[c],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(u)},o=self["webpackChunkuser_center_frontend_vue"]=self["webpackChunkuser_center_frontend_vue"]||[];o.forEach(a.bind(null,0)),o.push=a.bind(null,o.push.bind(o))}();var o=t.O(void 0,[504],(function(){return t(4594)}));o=t.O(o)})();
//# sourceMappingURL=app.b643eaf2.js.map